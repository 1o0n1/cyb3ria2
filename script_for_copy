#!/bin/bash

# Путь к корневой директории проекта
PROJECT_ROOT="/var/www/cyb3ria"

# Имя файла вывода (без номера)
OUTPUT_FILE_BASE="$PROJECT_ROOT/project_contents"

# Функция для проверки и изменения имени файла
get_available_filename() {
  local base="$1"
  local filename="$base.txt"
  local counter=1

  while [ -f "$filename" ]; do
    filename="${base}_${counter}.txt"
    ((counter++))
  done

 
  echo "$filename"
}

# Определяем имя файла вывода, которое не существует
OUTPUT_FILE=$(get_available_filename "$OUTPUT_FILE_BASE")

# Функция для обработки файла
process_file() {
  FILE_PATH="$1"
  echo "$FILE_PATH" >> "$OUTPUT_FILE"
  echo "" >> "$OUTPUT_FILE"
  cat "$FILE_PATH" >> "$OUTPUT_FILE"
  echo -e "\n\n\n" >> "$OUTPUT_FILE"
}

# Список файлов в новой структуре
FILES=(
  "$PROJECT_ROOT/.env"
  "$PROJECT_ROOT/Cargo.toml"
  "$PROJECT_ROOT/src/main.rs"
  "$PROJECT_ROOT/src/db.rs"
  "$PROJECT_ROOT/src/error.rs"
  "$PROJECT_ROOT/src/state.rs"
  "$PROJECT_ROOT/src/config.rs"
  "$PROJECT_ROOT/src/auth.rs"
  "$PROJECT_ROOT/src/routes/mod.rs"
  "$PROJECT_ROOT/src/routes/users.rs"
  "$PROJECT_ROOT/src/routes/messages.rs"
  "$PROJECT_ROOT/src/routes/discussions.rs"
  "$PROJECT_ROOT/src/routes/comments.rs"
  "$PROJECT_ROOT/src/handlers/mod.rs"
  "$PROJECT_ROOT/src/handlers/user_handler.rs"
  "$PROJECT_ROOT/src/handlers/message_handler.rs"
  "$PROJECT_ROOT/src/handlers/discussion_handler.rs"
  "$PROJECT_ROOT/src/handlers/comment_handler.rs"
  "$PROJECT_ROOT/src/models/mod.rs"
  "$PROJECT_ROOT/src/models/user.rs"
  "$PROJECT_ROOT/src/models/message.rs"
  "$PROJECT_ROOT/src/models/discussion.rs"
  "$PROJECT_ROOT/src/models/comment.rs"
  "$PROJECT_ROOT/static/index.html"
  "$PROJECT_ROOT/static/statix.css"
  "$PROJECT_ROOT/migrations/20250810000001_create_users_table.sql"
  "$PROJECT_ROOT/migrations/20250810000002_create_messages.sql"
  "$PROJECT_ROOT/migrations/20250810000003_create_discussions.sql"
  "$PROJECT_ROOT/migrations/20250810000004_create_comments.sql"
  "$PROJECT_ROOT/migrations/20250810000005_add_public_key_to_users.sql"
  "$PROJECT_ROOT/migrations/20250810000006_add_recipient_to_messages.sql"
  
  
)

# Обрабатываем файлы из списка
for FILE in "${FILES[@]}"; do
  process_file "$FILE"
done

echo "Содержимое проекта записано в файл: $OUTPUT_FILE"
